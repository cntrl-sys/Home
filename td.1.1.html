<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>version 1.1</title>
<style>
  body { display: flex; justify-content: center; align-items: center; height: 100vh; background: #222; color: #fff; font-family: sans-serif; }
  canvas { background: #333; border: 2px solid #555; cursor: pointer; }
</style>
</head>
<body>
<canvas id="gameCanvas" width="600" height="400"></canvas>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// Spielfeld-Pfad (Kurven)
const path = [
  {x: 0, y: 100},
  {x: 200, y: 100},
  {x: 200, y: 300},
  {x: 400, y: 300},
  {x: 400, y: 100},
  {x: 600, y: 100}
];

// Spieler Stats
let money = 200;
let lives = 10;

// Gegnerklassen
class Enemy {
  constructor(type="normal") {
    this.x = path[0].x;
    this.y = path[0].y;
    this.pathIndex = 0;
    if(type==="fast") { this.hp=50; this.speed=2; this.color="orange"; }
    else if(type==="tank") { this.hp=200; this.speed=0.5; this.color="purple"; }
    else { this.hp=100; this.speed=1; this.color="red"; }
  }

  move() {
    let target = path[this.pathIndex+1];
    if(!target) return;
    let dx = target.x - this.x;
    let dy = target.y - this.y;
    let dist = Math.sqrt(dx*dx + dy*dy);
    if(dist < this.speed) this.pathIndex++;
    else {
      this.x += (dx/dist)*this.speed;
      this.y += (dy/dist)*this.speed;
    }
  }

  draw() {
    ctx.fillStyle = this.color;
    ctx.fillRect(this.x-10, this.y-10, 20, 20);
    ctx.fillStyle = "green";
    ctx.fillRect(this.x-10, this.y-15, 20*(this.hp/200), 3);
  }
}

// Turmklasse
class Tower {
  constructor(x, y) {
    this.x = x;
    this.y = y;
    this.range = 100;
    this.damage = 20;
    this.cooldown = 0;
    this.level = 1;
  }

  shoot(enemies) {
    if(this.cooldown > 0) { this.cooldown--; return; }
    for(let enemy of enemies) {
      let dx = enemy.x - this.x;
      let dy = enemy.y - this.y;
      let distance = Math.sqrt(dx*dx + dy*dy);
      if(distance <= this.range) {
        enemy.hp -= this.damage;
        this.cooldown = 30;
        break;
      }
    }
  }

  draw() {
    ctx.fillStyle = "blue";
    ctx.beginPath();
    ctx.arc(this.x, this.y, 15, 0, 2*Math.PI);
    ctx.fill();
    ctx.strokeStyle = "rgba(0,0,255,0.3)";
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.range, 0, 2*Math.PI);
    ctx.stroke();
    ctx.fillStyle = "white";
    ctx.fillText("L"+this.level, this.x-7, this.y+5);
  }

  upgrade() {
    if(money >= 50) {
      money -= 50;
      this.damage += 10;
      this.range += 10;
      this.level++;
    }
  }
}

// Arrays
let enemies = [];
let towers = [];

// Gegner spawnen
function spawnEnemy() {
  const r = Math.random();
  if(r < 0.6) enemies.push(new Enemy("normal"));
  else if(r < 0.85) enemies.push(new Enemy("fast"));
  else enemies.push(new Enemy("tank"));
}

// Klick für Türme setzen oder Upgrades
canvas.addEventListener("click", (e)=>{
  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;

  // Prüfe, ob auf Turm geklickt → upgrade
  for(let tower of towers) {
    let dx = tower.x - x;
    let dy = tower.y - y;
    if(Math.sqrt(dx*dx+dy*dy) < 15) {
      tower.upgrade();
      return;
    }
  }

  // Sonst neuen Turm setzen
  if(money >= 50) {
    towers.push(new Tower(x, y));
    money -= 50;
  }
});

// Game Loop
function gameLoop() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Pfad zeichnen
  ctx.strokeStyle = "yellow";
  ctx.lineWidth = 20;
  ctx.beginPath();
  ctx.moveTo(path[0].x, path[0].y);
  for(let i=1; i<path.length; i++) ctx.lineTo(path[i].x, path[i].y);
  ctx.stroke();

  // Gegner spawnen
  if(Math.random() < 0.02) spawnEnemy();

  // Gegner bewegen & zeichnen
  for(let i = enemies.length-1; i >= 0; i--) {
    let enemy = enemies[i];
    enemy.move();
    enemy.draw();
    if(enemy.pathIndex >= path.length-1) { lives--; enemies.splice(i,1); }
    else if(enemy.hp <= 0) { money += 10; enemies.splice(i,1); }
  }

  // Türme schießen & zeichnen
  for(let tower of towers) {
    tower.shoot(enemies);
    tower.draw();
  }

  // HUD
  ctx.fillStyle = "white";
  ctx.fillText("Geld: "+money+"   Leben: "+lives, 10, 20);

  // Game Over
  if(lives <= 0) {
    ctx.fillStyle = "red";
    ctx.font = "40px sans-serif";
    ctx.fillText("Game Over", 200, 200);
  } else requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
