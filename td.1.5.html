<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Tower Defense</title>
<style>
body{
margin:0;
background:#111;
display:flex;
justify-content:center;
align-items:center;
height:100vh;
}
canvas{
background:#2f6b2f;
border:2px solid #444;
}
</style>
</head>
<body>

<canvas id="game" width="900" height="500"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const path = [
{x:0,y:250},
{x:250,y:250},
{x:250,y:100},
{x:650,y:100},
{x:650,y:400},
{x:900,y:400}
];

let enemies=[];
let towers=[];
let shots=[];

let money=200;
let lives=10;
let wave=1;
let spawnTimer=0;

let currentTower="normal";

// -------- ENEMY --------
class Enemy{
constructor(isBoss=false){
this.x=path[0].x;
this.y=path[0].y;
this.i=0;
this.boss=isBoss;

this.hp=isBoss?600+wave*150:120+wave*20;
this.speed=isBoss?0.6:1+wave*0.05;
this.size=isBoss?26:18;
this.reward=isBoss?120:10;
}

move(){
let t=path[this.i+1];
if(!t)return;

let dx=t.x-this.x;
let dy=t.y-this.y;
let d=Math.hypot(dx,dy);

if(d<this.speed)this.i++;
else{
this.x+=dx/d*this.speed;
this.y+=dy/d*this.speed;
}
}

draw(){
ctx.fillStyle=this.boss?"black":"red";
ctx.beginPath();
ctx.arc(this.x,this.y,this.size/2,0,Math.PI*2);
ctx.fill();

ctx.fillStyle="green";
ctx.fillRect(this.x-15,this.y-18,30*(this.hp/900),4);
}
}

// -------- TOWER --------
class Tower{
constructor(x,y,type){
this.x=x;
this.y=y;
this.type=type;
this.level=1;
this.cool=0;

if(type=="fire"){
this.range=90;
this.damage=22;
this.coolMax=18;
}
else if(type=="ice"){
this.range=110;
this.damage=12;
this.coolMax=30;
}
else if(type=="sniper"){
this.range=230;
this.damage=70;
this.coolMax=90;
}
else{
this.range=120;
this.damage=25;
this.coolMax=25;
}
}

shoot(){
if(this.cool>0){this.cool--;return;}

for(let e of enemies){
let d=Math.hypot(e.x-this.x,e.y-this.y);
if(d<this.range){
e.hp-=this.damage;
shots.push({x:this.x,y:this.y,tx:e.x,ty:e.y});
this.cool=this.coolMax;
break;
}
}
}

upgrade(){
if(money>=50){
money-=50;
this.level++;
this.damage+=10;
this.range+=8;
}
}

draw(){
if(this.type=="fire")ctx.fillStyle="orange";
else if(this.type=="ice")ctx.fillStyle="cyan";
else if(this.type=="sniper")ctx.fillStyle="purple";
else ctx.fillStyle="blue";

ctx.beginPath();
ctx.arc(this.x,this.y,14,0,Math.PI*2);
ctx.fill();

ctx.fillStyle="white";
ctx.font="12px Arial";
ctx.fillText("L"+this.level,this.x-8,this.y+4);
}
}

// -------- SPAWN --------
function spawnWave(){
spawnTimer++;

if(spawnTimer%40===0){
enemies.push(new Enemy());
}

if(spawnTimer>350){
enemies.push(new Enemy(true)); // Boss
spawnTimer=0;
wave++;
}
}

// -------- CONTROLS --------
canvas.addEventListener("click",e=>{

for(let t of towers){
if(Math.hypot(t.x-e.offsetX,t.y-e.offsetY)<14){
t.upgrade();
return;
}
}

if(money>=50){
towers.push(new Tower(e.offsetX,e.offsetY,currentTower));
money-=50;
}
});

document.addEventListener("keydown",e=>{
if(e.key==="1")currentTower="normal";
if(e.key==="2")currentTower="fire";
if(e.key==="3")currentTower="ice";
if(e.key==="4")currentTower="sniper";
});

// -------- DRAW PATH --------
function drawPath(){
ctx.strokeStyle="#c2a36b";
ctx.lineWidth=18;
ctx.beginPath();
ctx.moveTo(path[0].x,path[0].y);
for(let i=1;i<path.length;i++){
ctx.lineTo(path[i].x,path[i].y);
}
ctx.stroke();
}

// -------- LOOP --------
function loop(){
ctx.clearRect(0,0,900,500);

drawPath();
spawnWave();

// enemies
for(let i=enemies.length-1;i>=0;i--){
let e=enemies[i];
e.move();
e.draw();

if(e.i>=path.length-1){
lives--;
enemies.splice(i,1);
}
else if(e.hp<=0){
money+=e.reward;
enemies.splice(i,1);
}
}

// towers
for(let t of towers){
t.shoot();
t.draw();
}

// shots
for(let i=shots.length-1;i>=0;i--){
let s=shots[i];
ctx.strokeStyle="white";
ctx.beginPath();
ctx.moveTo(s.x,s.y);
ctx.lineTo(s.tx,s.ty);
ctx.stroke();
shots.splice(i,1);
}

// HUD
ctx.fillStyle="white";
ctx.font="16px Arial";
ctx.fillText("Geld: "+money,10,20);
ctx.fillText("Leben: "+lives,10,40);
ctx.fillText("Welle: "+wave,10,60);
ctx.fillText("Tower: 1 Normal 2 Fire 3 Ice 4 Sniper",10,90);

if(lives<=0){
ctx.fillStyle="red";
ctx.font="40px Arial";
ctx.fillText("GAME OVER",340,260);
}

requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
