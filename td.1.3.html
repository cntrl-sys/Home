<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>version 1.3</title>
<style>
body{
background:#222;
display:flex;
justify-content:center;
align-items:center;
height:100vh;
color:white;
font-family:Arial;
}
canvas{
background:#333;
border:2px solid #555;
}
</style>
</head>
<body>

<canvas id="game" width="800" height="450"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const path = [
{x:0,y:120},{x:200,y:120},{x:200,y:330},{x:500,y:330},{x:500,y:120},{x:800,y:120}
];

let enemies=[];
let towers=[];
let shots=[];

let money=300;
let lives=10;
let wave=1;
let spawnTimer=0;

class Enemy{
constructor(type){
this.type=type;
this.x=path[0].x;
this.y=path[0].y;
this.i=0;
this.slow=0;

if(type=="fast"){
this.hp=70+wave*10;
this.speed=2.5;
this.color="orange";
this.reward=15;
}
else if(type=="tank"){
this.hp=250+wave*40;
this.speed=0.6;
this.color="purple";
this.reward=30;
}
else if(type=="fly"){
this.hp=120+wave*20;
this.speed=2;
this.color="cyan";
this.reward=20;
}
else if(type=="boss"){
this.hp=600+wave*150;
this.speed=0.8;
this.color="black";
this.reward=100;
}
else{
this.hp=120+wave*20;
this.speed=1;
this.color="red";
this.reward=10;
}
}

move(){
let speed=this.slow>0?this.speed/2:this.speed;
if(this.slow>0)this.slow--;

let target=path[this.i+1];
if(!target)return;

let dx=target.x-this.x;
let dy=target.y-this.y;
let dist=Math.hypot(dx,dy);

if(dist<speed)this.i++;
else{
this.x+=dx/dist*speed;
this.y+=dy/dist*speed;
}
}

draw(){
ctx.fillStyle=this.color;
ctx.fillRect(this.x-10,this.y-10,20,20);

ctx.fillStyle="green";
ctx.fillRect(this.x-10,this.y-15,20*(this.hp/800),3);
}
}

class Tower{
constructor(x,y,type){
this.x=x;
this.y=y;
this.type=type;
this.level=1;

if(type=="fire"){
this.range=90;
this.damage=15;
this.coolMax=20;
}
else if(type=="ice"){
this.range=110;
this.damage=10;
this.coolMax=35;
}
else if(type=="sniper"){
this.range=230;
this.damage=60;
this.coolMax=90;
}
else{
this.range=120;
this.damage=20;
this.coolMax=30;
}

this.cool=0;
}

shoot(){
if(this.cool>0){this.cool--;return;}

for(let e of enemies){
let d=Math.hypot(e.x-this.x,e.y-this.y);
if(d<=this.range){

e.hp-=this.damage;
if(this.type=="ice") e.slow=40;

shots.push({x:this.x,y:this.y,tx:e.x,ty:e.y});

this.cool=this.coolMax;
break;
}
}
}

upgrade(){
if(money>=50){
money-=50;
this.level++;
this.damage+=10;
this.range+=10;
}
}

draw(){
if(this.type=="fire")ctx.fillStyle="orange";
else if(this.type=="ice")ctx.fillStyle="cyan";
else if(this.type=="sniper")ctx.fillStyle="magenta";
else ctx.fillStyle="blue";

ctx.beginPath();
ctx.arc(this.x,this.y,15,0,Math.PI*2);
ctx.fill();

ctx.strokeStyle="rgba(255,255,255,0.2)";
ctx.beginPath();
ctx.arc(this.x,this.y,this.range,0,Math.PI*2);
ctx.stroke();

ctx.fillStyle="white";
ctx.fillText("L"+this.level,this.x-8,this.y+5);
}
}

function spawnWave(){
spawnTimer++;

if(spawnTimer%40==0){
let r=Math.random();
if(r<0.45) enemies.push(new Enemy("normal"));
else if(r<0.65) enemies.push(new Enemy("fast"));
else if(r<0.82) enemies.push(new Enemy("tank"));
else if(r<0.95) enemies.push(new Enemy("fly"));
else enemies.push(new Enemy("boss"));
}

if(spawnTimer>450){
spawnTimer=0;
wave++;
}
}

canvas.addEventListener("click",e=>{
let rect=canvas.getBoundingClientRect();
let x=e.clientX-rect.left;
let y=e.clientY-rect.top;

for(let t of towers){
if(Math.hypot(t.x-x,t.y-y)<15){
t.upgrade();
return;
}
}

if(money>=50){
towers.push(new Tower(x,y,"normal"));
money-=50;
}
});

document.addEventListener("keydown",e=>{
if(e.key=="1" && money>=50){towers.push(new Tower(120,220,"fire"));money-=50;}
if(e.key=="2" && money>=50){towers.push(new Tower(200,220,"ice"));money-=50;}
if(e.key=="3" && money>=50){towers.push(new Tower(280,220,"sniper"));money-=50;}
});

function drawPath(){
ctx.strokeStyle="yellow";
ctx.lineWidth=20;
ctx.beginPath();
ctx.moveTo(path[0].x,path[0].y);
for(let i=1;i<path.length;i++)ctx.lineTo(path[i].x,path[i].y);
ctx.stroke();
}

function gameLoop(){
ctx.clearRect(0,0,canvas.width,canvas.height);

drawPath();

spawnWave();

for(let i=enemies.length-1;i>=0;i--){
let e=enemies[i];
e.move();
e.draw();

if(e.i>=path.length-1){
lives--;
enemies.splice(i,1);
}
else if(e.hp<=0){
money+=e.reward;
enemies.splice(i,1);
}
}

for(let t of towers){
t.shoot();
t.draw();
}

for(let i=shots.length-1;i>=0;i--){
let s=shots[i];
ctx.strokeStyle="white";
ctx.beginPath();
ctx.moveTo(s.x,s.y);
ctx.lineTo(s.tx,s.ty);
ctx.stroke();
shots.splice(i,1);
}

ctx.fillStyle="white";
ctx.fillText("Geld: "+money,10,20);
ctx.fillText("Leben: "+lives,10,40);
ctx.fillText("Welle: "+wave,10,60);
ctx.fillText("1=Fire  2=Ice  3=Sniper  Klick=Upgrade",10,80);

if(lives<=0){
ctx.fillStyle="red";
ctx.font="40px Arial";
ctx.fillText("GAME OVER",320,220);
}
else requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
